# default.conf is AUTOGENERATED
# This file is identical to default.template except with SSL certs (https)
# Serve static assets and handle login requests
server {
  listen $PORT ssl http2;
  listen [::]:$PORT ssl; # IPv6 support
  server_name $APP_FQDN;

  # Comment this out to see access logs
  access_log off;

  client_max_body_size 50M;
  default_type text/plain;

  ssl_certificate /etc/nginx/conf.d/certs/$APP_FQDN.pem;
  ssl_certificate_key /etc/nginx/conf.d/certs/$APP_FQDN-key.pem;

  # Used by the docker-compose healthcheck
  location /healthcheck {
    access_log off;
    # because default content-type is application/octet-stream,
    # browser will offer to "save the file"...
    add_header Content-Type text/plain;
    return 200 'OK';
  }

  location / {
    proxy_pass http://server:8000;
    proxy_set_header Host $host;
  }
}
